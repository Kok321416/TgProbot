#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Git SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./setup-git-ssh.sh

set -e

echo "üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git SSH –¥–æ—Å—Ç—É–ø–∞"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Git
if ! command -v git &> /dev/null; then
    echo "‚ùå Git –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º..."
    sudo apt update
    sudo apt install -y git
else
    echo "‚úÖ Git —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ SSH –∫–ª—é—á–∞
if [ ! -f ~/.ssh/id_rsa ]; then
    echo "üîë –°–æ–∑–¥–∞—ë–º SSH –∫–ª—é—á..."
    read -p "–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è SSH –∫–ª—é—á–∞: " email
    ssh-keygen -t rsa -b 4096 -C "$email" -f ~/.ssh/id_rsa -N ""
    echo "‚úÖ SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω"
else
    echo "‚úÖ SSH –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
fi

# –î–æ–±–∞–≤–ª—è–µ–º SSH –∫–ª—é—á –≤ ssh-agent
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_rsa

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
echo ""
echo "üìã –í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π SSH –∫–ª—é—á:"
echo "============================================"
cat ~/.ssh/id_rsa.pub
echo "============================================"
echo ""
echo "üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á –≤—ã—à–µ"
echo "2. –û—Ç–∫—Ä–æ–π—Ç–µ https://github.com/settings/keys"
echo "3. –ù–∞–∂–º–∏—Ç–µ 'New SSH key'"
echo "4. –í—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á"
echo "5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ"
echo ""
echo "–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É git clone"
